# Repository Guidelines

## Project Structure & Module Organization
The application entry point lives in `main.py`; runtime composition now sits in `src/runtime/` (builder, tool gateway, aggregates) and the deterministic Plan→ReAct pipeline lives in `src/reasoning/plan_react/`. Governance policies live under `src/policies/`, legacy orchestration pieces remain in `src/agents/`, safeguards in `src/filters/`, observability helpers in `src/observability/`, and tool plugins in `src/plugins/`. Shared configuration defaults reside in `config.py`; environment overrides land in `.env`. Integration demos are bundled under `examples/`, dashboards under `monitoring/`, and automated tests mirror the layout via `tests/unit/` and `tests/integration/`.

## Build, Test, and Development Commands
Run `make setup-dev` once to install dev dependencies and register pre-commit hooks. Use `make test` for the full pytest + coverage suite, `make test-unit` for fast iterations, and `make test-integration` for HITL flows. Quality gates remain packaged: `make format`, `make lint`, `make type-check`, and `make security-check`; `make check` chains the standard pre-PR checks, while `make demo` exercises the end-to-end Plan→ReAct demo and shows policy/approval decisions. Scaffold new plugins with `python scripts/create_plugin.py MyPlugin "Short description"` to get a governance-ready template.

## Coding Style & Naming Conventions
Target Python 3.11+ and keep lines <=120 characters to match the Black/isort profiles in `pyproject.toml`. Prefer explicit type hints; MyPy runs in strict mode, so annotate public functions and generators. Follow PEP 8 naming (snake_case functions, PascalCase classes) and reserve ALL_CAPS for module constants. Let pre-commit manage `black`, `isort`, `flake8`, and `bandit` before pushing.

## Testing Guidelines
Write new tests beside the code they cover, using pytest markers (`@pytest.mark.unit`, `@pytest.mark.integration`) to control scope. Maintain the HTML coverage report generated by `make test`; enforce `make test-coverage` before large merges to stay above the 80% threshold. Reuse fixtures from `tests/fixtures/` and prefer descriptive names (`test_plan_react_requests_extension`) to clarify behaviour. Add targeted tests for reasoning strategies under `tests/unit/reasoning/`, telemetry helpers under `tests/unit/observability/`, and plugin scaffolding utilities under `tests/unit/plugins/` as they evolve.

## Commit & Pull Request Guidelines
History shows concise, lower-case summaries (`git log --oneline`); keep future commits under ~60 characters in the imperative voice (e.g., "wire plan-react runtime"). Reference tickets in the body when relevant and group logical changes together. For PRs, include a problem statement, testing evidence (command output or screenshots), configuration notes, and any monitoring updates so reviewers can confirm agent behaviour quickly.

## Configuration & Observability Tips
Never commit real secrets; load them via environment variables consumed by `pydantic-settings`. When adding telemetry, route spans and metrics through `src/observability/` and hook into the `PlanReactCoordinator` so reasoning steps emit structured events. Update `monitoring/` notebooks or dashboards when you change agent intents or feedback loops so on-call contributors can trace interactions end-to-end.
